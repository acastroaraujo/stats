<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Statistics Notes - 7&nbsp; Identification and Time</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./other-00-intro.html" rel="next">
<link href="./causality-03-matching.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Identification and Time</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Statistics Notes</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./00-regression.html" class="sidebar-item-text sidebar-link">Regression</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./std-errors.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Standard Errors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./marginal-effects.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Marginal Effects</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./causality-00-intro.html" class="sidebar-item-text sidebar-link">Causality</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./causality-01-experiments.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Experiments</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./causality-02-regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Regression Adjustments</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./causality-03-matching.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Matching</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./causality-04-time.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Identification and Time</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./other-00-intro.html" class="sidebar-item-text sidebar-link">Other</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./other-01-gps.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Gaussian Proccesses</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#fixed-effects" id="toc-fixed-effects" class="nav-link active" data-scroll-target="#fixed-effects"><span class="toc-section-number">7.1</span>  Fixed Effects</a></li>
  <li><a href="#difference-in-differences" id="toc-difference-in-differences" class="nav-link" data-scroll-target="#difference-in-differences"><span class="toc-section-number">7.2</span>  Difference-in-Differences</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="toc-section-number">7.3</span>  Exercises</a></li>
  <li><a href="#regression-discontinuity" id="toc-regression-discontinuity" class="nav-link" data-scroll-target="#regression-discontinuity"><span class="toc-section-number">7.4</span>  Regression Discontinuity?</a></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources"><span class="toc-section-number">7.5</span>  Additional Resources</a></li>
  <li><a href="#extra" id="toc-extra" class="nav-link" data-scroll-target="#extra"><span class="toc-section-number">7.6</span>  Extra</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Identification and Time</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<details>
<summary>Setup</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_family =</span> <span class="st">"Crimson Text"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This notebook deals with methods that use time to solve causal inference problems.</p>
<p>Fixed effects</p>
<p>Differences in differences</p>
<p>Regression discontinuity</p>
<p><em>Bring the stuff from the longitudinal notebooks.</em></p>
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 48%">
<col style="width: 32%">
</colgroup>
<tbody>
<tr class="odd">
<td></td>
<td>Observed</td>
<td>Unobserved</td>
</tr>
<tr class="even">
<td>Time-constant</td>
<td>Experiments, Matching, Regression, FE</td>
<td>Experiments, FE</td>
</tr>
<tr class="odd">
<td>Time-varying</td>
<td>Experiments, Matching, Regression, FE</td>
<td>Experiments, Experiments</td>
</tr>
</tbody>
</table>
<section id="fixed-effects" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="fixed-effects"><span class="header-section-number">7.1</span> Fixed Effects</h2>
<p><strong>Identification using <em>variation within</em> groups or individuals</strong></p>
<p>Repeated observations within groups or individuals can provide a means for adjusting for unobserved confounders. This is conceptually similar to twin studies in which we look for variation <em>within</em> pairs of twins. We can extend this to larger groups or repeated observations.</p>
<p>The simplest regression model that handles this simply adds <em>varying-intercepts</em> <span class="math inline">\(\alpha_i\)</span> or “fixed effects.”</p>
<p><span class="math display">\[
y_{ij} = \beta_0 + \theta x_{ij} + \alpha_i + \varepsilon_{ij}
\]</span></p>
<p>With more than two observations per group, we can fit this model using <em>differences.</em></p>
<p><span class="math display">\[
y_{ij} - \overline y_i = \theta (x_{ij} - \overline x_i) + \varepsilon_{ij} - \overline \varepsilon_{i}
\]</span></p>
<p><strong>The causal predictor needs to vary <em>within</em> groups.</strong></p>
<blockquote class="blockquote">
<p>This study design can create comparisons across different levels of the treatment variable only if it varies within group. In examples where the treatment is dichotomous, it is possible for a substantial portion of the sample to exhibit no variation at all in the causal variable <em>within groups.</em> For instance, suppose a varying-intercepts model is used to estimate the effect of maternal employment on child cognitive outcomes by including indicators for each family (set of siblings) in a regression of outcomes on an indicator for whether the mother worked in the first year of the child’s life. In some families, the mother may not have varied her employment status across children. Therefore, no inferences about the effect of maternal employment status can be made for these families. We can only estimate effects for the type of family where the mother varied her employment choice across the children (for example, working after her first child was born but staying home from work after the second).</p>
<p><span class="citation" data-cites="gelman2020">Gelman, Hill, and Vehtari (<a href="references.html#ref-gelman2020" role="doc-biblioref">2020, 441</a>)</span></p>
</blockquote>
<p><strong>Within-person variation (or “fixed effects”)</strong></p>
<p>Panel data provides the most common use of varying intercepts to estimate causal effects. Here we use repeated observations within the same individuals to adjust for time-constant unobserved confounders. Here, issues of balance and overlap still exist, but they only apply for <em>within-</em>person comparisons.</p>
<p>If the purpose of <strong>matching/weighting</strong> is to get rid of all observable confounders, then the purpose of <strong>fixed-effects</strong> is to <em>additionally</em> get rid of all time-constant unobserved confounders.</p>
<p><strong>Weight Loss Example</strong></p>
<p>Let’s say I weigh an individual in January (time 1) and again in July (time 2). This individual was not dieting before January, but does diet between January and July. In July, we find that the individual weighs 10kg less.</p>
<p>We want to know how much the diet <em>caused</em> the individual’s weight to change. That is, I’d like to compare the actual weight loss ( <span class="math inline">\(\text{weight}_\text{July}^1 - \text{weight}_\text{Jan}^1\)</span> ) to a counterfactual weight loss in a world where where there is no diet ( <span class="math inline">\(\text{weight}_\text{July}^0 - \text{weight}_\text{Jan}^0\)</span> ).</p>
<p>We can represent weight at two different time points using the following equations:</p>
<p><span class="math display">\[
\begin{align}
\text{weight}_1 &amp;= \theta \ \text{diet}_1 + \mu + \epsilon_1, \\
\text{weight}_2 &amp;= \theta \ \text{diet}_2 + \mu + \epsilon_2
\end{align}
\]</span></p>
<p>Here, <span class="math inline">\(\theta\)</span> is the <em>treatment effect</em> of the diet; <span class="math inline">\(\mu\)</span> represents everything about the individual that <em>does not</em> change (i.e., time-constant) and that affects their weight (i.e., a personal <em>fixed effect);</em> <span class="math inline">\(\epsilon_1\)</span> and <span class="math inline">\(\epsilon_2\)</span> represent other time-varying effects on weight.</p>
<p>Finally, because we already assumed that the individual was not dieting at time 1, we know that <span class="math inline">\(\text{diet}_1 = 0\)</span>. Subtracting both equations, we get the following:</p>
<p><span class="math display">\[
\text{weight}_2 - \text{weight}_1 = \theta + \underbrace{(\mu - \mu)}_{0}  + (\epsilon_2 - \epsilon_1)
\]</span></p>
<p>The power of fixed-effects estimation allows us to get rid of <span class="math inline">\((\mu - \mu)\)</span> by simple subtraction; by comparing individuals to themselves (<em>within-person</em> variance), we have gotten rid of <em>everything</em> about them that does not change (i.e., time-constant), <em>even if we do not know what that is.</em></p>
<p>In other words, this simple pre-post comparison allows for a good estimate of <span class="math inline">\(\theta\)</span> <em>if</em> we are also willing to believe that <span class="math inline">\(E[\epsilon_2 - \epsilon_1] = 0\)</span>. Maybe the individual would have lost weight anyway even without dieting because January is during the holidays when it is easier to gain weight (i.e., <span class="math inline">\(\epsilon_1 &gt; \epsilon_2)\)</span>.</p>
<p>To deal with this, we might want to compare people who diet between January and July with those who do <em>not</em> diet over the same period to capture the effect of the passage of time. This is called <strong>difference-in-differences</strong> estimation.</p>
</section>
<section id="difference-in-differences" class="level2 page-columns page-full" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="difference-in-differences"><span class="header-section-number">7.2</span> Difference-in-Differences</h2>
<p><strong>Identification using within <em>and</em> between group variation.</strong></p>
<p>Almost all identification strategies rely on comparisons across groups that have and have not been exposed to a treatment. <em>Difference-in-differences</em> strategies additionally make use of another source of variation—i.e., time—to help adjust for potential unobserved differences across groups.</p>
<p>The goal is to be able to compare the <em>within</em> variation in the treated group to the <em>within</em> variation in the untreated group.</p>
<p><strong>Assumptions</strong></p>
<p>The change in <span class="math inline">\(y\)</span> for the control group needs to represent what <em>would</em> have happened to the treatment group in the absence of the treatment.</p>
<p>Potential change, given that <span class="math inline">\(P=1\)</span> means post-exposure and <span class="math inline">\(P=0\)</span> means pre-exposure.</p>
<p><span class="math display">\[
\begin{align}
d^0 &amp;= y^0_{P=1} - y^0_{P=0}, \\\\
d^1 &amp;= y^1_{P=1} - y^1_{P=0}
\end{align}
\]</span></p>
<p><em>Average Treatment Effects:</em></p>
<p><span class="math display">\[
\begin{align}
\text{ATE} &amp;= \text{E}[d^1 - d^0], \\\\
\text{ATT} &amp;= \text{E}[d^1 - d^0 \mid T = 1], \\\\
\text{ATU} &amp;= \text{E}[d^1 - d^0 \mid T = 0]
\end{align}
\]</span></p>
<p><em>Ignorability assumption:</em></p>
<p><span class="math display">\[
d^0, d^1 \perp T
\]</span></p>
<blockquote class="blockquote">
<p>This design is often presented as if it provides a weaker set of assumptions than traditional observational studies, as it a quasi-experiment, not just a study where we have to hope we’ve measured all confounders. However, looking carefully at the assumptions, it is unclear if the assumption of randomly assigned changes in potential outcome is truly more plausible than the assumption of randomly assigned potential outcomes for those with the same value of the pre-treatment variable (and of course both approaches could allow for conditioning on additional covariates). In either case, we need not assume actual random manipulation of treatment assignment for either assumption to hold, only results that would be consistent with such manipulation.</p>
<p><span class="citation" data-cites="gelman2020">Gelman, Hill, and Vehtari (<a href="references.html#ref-gelman2020" role="doc-biblioref">2020, 444–45</a>)</span></p>
</blockquote>
<p>The <strong>parallel trends</strong> assumption is inherently <em>unobservable.</em> It says that the difference between the treated and untreated groups <em>would</em> have remained the same in the post-treatment period as it was in the pre-treatment period, as depicted in <a href="#fig-parallel-trends">Figure&nbsp;<span>7.1</span></a>. This assumption fails, among other reasons, when there are <em>other</em> treatments affecting the untreated groups that are absent in the treated groups.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">t =</span> <span class="fu">c</span>(<span class="st">"Time 0"</span>, <span class="st">"Time 1"</span>),</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y1 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y0 =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span><span class="fu">c</span>(t, y), <span class="at">names_to =</span> <span class="st">"g"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(t, value, <span class="at">group =</span> g)) <span class="sc">+</span> </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="st">"Time 0"</span>, <span class="st">"Time 1"</span>)) <span class="sc">+</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(t, y)) <span class="sc">+</span> </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x =</span> <span class="st">"Time 1"</span>, <span class="at">y =</span> <span class="dv">2</span>, <span class="at">yend =</span> <span class="dv">3</span>, <span class="at">xend =</span> <span class="st">"Time 1"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>, </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"steelblue1"</span>) <span class="sc">+</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="cn">NULL</span>) <span class="sc">+</span> </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">2.2</span>, <span class="at">y =</span> <span class="fl">2.5</span>, <span class="at">label =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(r<span class="st">"($E[d^1 - d^0]$)"</span>), <span class="at">family =</span> <span class="st">"Crimson Text"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-parallel-trends" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="causality-04-time_files/figure-html/fig-parallel-trends-1.png" class="img-fluid figure-img" width="384"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7.1: Parallel Trends</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><em>Note. If parallel trends hold for</em> <span class="math inline">\(Y\)</span><em>, then it does not hold for</em> <span class="math inline">\(\log(Y)\)</span> <em>or any other non-linear transformation.</em></p>
<p><strong>Regression Framework</strong></p>
<p>Suppose that time is represented with a simple before-and-after exposure variable <span class="math inline">\(P\)</span>. We can see the difference-in-differences strategies within the traditional regression framework in terms of a simple interaction.</p>
<p><span id="eq-diff-interaction"><span class="math display">\[
y_i = \beta_0 + \beta_1 x_i + \beta_2 P_i + \underbrace{\theta \ x_i P_i}_\text{diff-n-diff} + \varepsilon_i
\tag{7.1}\]</span></span></p>
<p>The difference-in-differences estimand is simply the coefficient on the interaction term.</p>
<blockquote class="blockquote">
<p>Intuitively this makes sense because the interaction term represents the difference in the slope coefficients on time across the treatment groups where the slope coefficients on time each represent a difference in means (across time points). Equivalently, we could say that the interaction term represents the difference in slope coefficients on treatment across the time periods.</p>
<p><span class="citation" data-cites="gelman2020">Gelman, Hill, and Vehtari (<a href="references.html#ref-gelman2020" role="doc-biblioref">2020, 443</a>)</span></p>
</blockquote>
<div id="tbl-diff-n-diff-toy" class="anchored">
<table class="table">
<caption>Table&nbsp;7.1: Toy Example</caption>
<thead>
<tr class="header">
<th></th>
<th><span class="math inline">\(X = 0\)</span></th>
<th><span class="math inline">\(X = 1\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(P = 0\)</span></td>
<td>80</td>
<td>80</td>
</tr>
<tr class="even">
<td><span class="math inline">\(P=1\)</span></td>
<td>75</td>
<td>70</td>
</tr>
</tbody>
</table>
</div>
<aside>
Note that <em>everyone</em> has the same time values “pre” and “post.” There is no <em>between</em> person variation in time. If there was, we would have to do something like <strong>two-way fixed effects</strong>.
</aside>
<p>We can combine the values in <a href="#tbl-diff-n-diff-toy">Table&nbsp;<span>7.1</span></a> with <a href="#eq-diff-interaction">Equation&nbsp;<span>7.1</span></a> to get the following values:</p>
<p><span class="math display">\[
\beta_0 = 80, \ \beta_1 = 0, \ \beta_2 = -5, \theta = -5
\]</span></p>
<p><strong>Two-way fixed effects</strong></p>
<p>Alternatively, we can think of this in terms of two-way fixed effects.</p>
<p><span id="eq-diff-twfe"><span class="math display">\[
y_i = \alpha_{g[i]} + \alpha_{t[i]} + \underbrace{\beta \ T_i}_\text{diff-n-diff} + \varepsilon_i
\tag{7.2}\]</span></span></p>
<p>The <span class="math inline">\(\theta\)</span> coefficient in <a href="#eq-diff-interaction">Equation&nbsp;<span>7.1</span></a> and <a href="#eq-diff-twfe">Equation&nbsp;<span>7.2</span></a> is equivalent, provided we only have two groups and two time periods.</p>
<p>Unfortunately, the TWFE approach for calculating difference-in-differences effects does <em>not</em> work particularly well for “rollout designs” (or “staggered treatment timing”) in which the treatment is applied at different times to different groups.</p>
<p>Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"organ_donations"</span>, <span class="at">package =</span> <span class="st">"causaldata"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plm)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> organ_donations <span class="sc">|&gt;</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treated =</span> state <span class="sc">==</span> <span class="st">"California"</span> <span class="sc">&amp;</span> quarter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Q32011'</span>,<span class="st">'Q42011'</span>,<span class="st">'Q12012'</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">factor</span>(state), <span class="at">quarter =</span> <span class="fu">factor</span>(quarter))</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>clfe <span class="ot">&lt;-</span> <span class="fu">feols</span>(rate <span class="sc">~</span> treated <span class="sc">|</span> state <span class="sc">+</span> quarter, <span class="at">data =</span> d)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>ols <span class="ot">&lt;-</span> <span class="fu">lm</span>(rate <span class="sc">~</span> treated <span class="sc">+</span> state <span class="sc">+</span> quarter, <span class="at">data =</span> d)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>twfe <span class="ot">&lt;-</span> <span class="fu">plm</span>(</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  rate <span class="sc">~</span> treated, </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"quarter"</span>, <span class="st">"state"</span>), </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">"within"</span>, </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">effect =</span> <span class="st">"twoways"</span>,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>modelsummary<span class="sc">::</span><span class="fu">modelsummary</span>(</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">feols =</span> clfe, <span class="at">lm =</span> ols, <span class="at">plm =</span> twfe), </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_omit =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>), </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_map =</span> <span class="st">"nobs"</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> feols </th>
   <th style="text-align:center;"> lm </th>
   <th style="text-align:center;"> plm </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> treatedTRUE </td>
   <td style="text-align:center;"> −0.022 </td>
   <td style="text-align:center;"> −0.022 </td>
   <td style="text-align:center;"> −0.022 </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (0.006) </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (0.020) </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (0.020) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Num.Obs. </td>
   <td style="text-align:center;"> 162 </td>
   <td style="text-align:center;"> 162 </td>
   <td style="text-align:center;"> 162 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p><em>Note the difference in standard errors.</em></p>
<p>Test of prior trends:</p>
<ol type="1">
<li><p>Use the data from before the treatment period.</p></li>
<li><p>Do a NHST on the <span class="math inline">\(\theta\)</span> coefficient in the following regression:</p>
<p><span class="math display">\[
y_i = \alpha_{g[i]} + \beta \ t_i + \theta \ t_i \times g_i + \varepsilon_i
\]</span></p></li>
</ol>
<p><strong><em>Dynamic Treatment Effects</em></strong></p>
<p>Instead of just focusing on “before” and “after” effects, we can add a separate effect for each time period. A common way of doing in this is to generated a <em>centered</em> time variable—i.e., you subtract the treatment period from the original time variable. Then we just interact the treatment variable with a set of indicator variables for each of the time periods.</p>
<p>For example, suppose we have 3 time periods and that the treatment occurs in <span class="math inline">\(t = 0\)</span>.</p>
<p><span class="math display">\[
y_i = \alpha_{g[i]} + \alpha_{t[i]} + \theta_{-1[i]} \times T_i + \theta_{1[i]} \times T_i + \varepsilon_i
\]</span></p>
<aside>
<span class="math inline">\(\theta_0\)</span> <em>is dropped to avoid perfect multicollinearity</em>
</aside>
<p>Here, we <em>should not</em> find discernible effects among the before-treatment coefficients. Our confidence intervals should also blow up in size because we have less data. <a href="#fig-diff-dynamic">Figure&nbsp;<span>7.2</span></a> presents the results for this kind of setup.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse); <span class="fu">library</span>(fixest)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>od <span class="ot">&lt;-</span> causaldata<span class="sc">::</span>organ_donations</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Treatment variable</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>od <span class="ot">&lt;-</span> od <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">California =</span> State <span class="sc">==</span> <span class="st">'California'</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Interact quarter with being in the treated group using</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># the fixest i() function, which also lets us specify</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># a reference period (using the numeric version of Quarter)</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>clfe <span class="ot">&lt;-</span> <span class="fu">feols</span>(Rate <span class="sc">~</span> <span class="fu">i</span>(Quarter_Num, California, <span class="at">ref =</span> <span class="dv">3</span>) <span class="sc">|</span> </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>            State <span class="sc">+</span> Quarter_Num, <span class="at">data =</span> od)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># And use coefplot() for a graph of effects</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="fu">coefplot</span>(clfe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-diff-dynamic" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="causality-04-time_files/figure-html/fig-diff-dynamic-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7.2: Dynamic Effects in Organ Donation Rates Example</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## something fucked up is going on here</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(od<span class="sc">$</span>Quarter_Num <span class="sc">-</span> 3L)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -2 -1  0  1  2  3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>od <span class="ot">&lt;-</span> od <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">num =</span> <span class="fu">factor</span>(Quarter_Num <span class="sc">-</span> 3L)) <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">num =</span> <span class="fu">fct_relevel</span>(num, <span class="st">"0"</span>))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(Rate <span class="sc">~</span> <span class="fu">factor</span>(State) <span class="sc">+</span> num <span class="sc">+</span> num<span class="sc">*</span>California, <span class="at">data =</span> od) <span class="sc">|&gt;</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>(<span class="at">conf.int =</span> <span class="cn">TRUE</span>)  <span class="sc">|&gt;</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">34</span><span class="sc">:</span><span class="dv">38</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(term, estimate)) <span class="sc">+</span> </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="causality-04-time_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Add example from Theory and Credibility</p>
<p><em>Note. If you combine difference-in-differences with matching, the answer will be exactly the same as long as you match on time-constant observable.</em></p>
</section>
<section id="exercises" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="exercises"><span class="header-section-number">7.3</span> Exercises</h2>
<p>diff-n-diff</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>nsw <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">read_dta</span>(<span class="st">"data/nsw.dta"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>nsw_long <span class="ot">&lt;-</span> nsw <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  panelr<span class="sc">::</span><span class="fu">long_panel</span>(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> <span class="st">"id"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">wave =</span> <span class="st">"t"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">periods =</span> <span class="fu">c</span>(<span class="dv">75</span>, <span class="dv">78</span>),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">label_location =</span> <span class="st">"end"</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">post =</span> <span class="fu">if_else</span>(t <span class="sc">==</span> <span class="dv">78</span>, 1L, 0L))</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(nsw_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,444
Columns: 12
Groups: id [722]
$ id        &lt;fct&gt; 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10…
$ t         &lt;dbl&gt; 75, 78, 75, 78, 75, 78, 75, 78, 75, 78, 75, 78, 75, 78, 75, …
$ data_id   &lt;chr&gt; "Lalonde Sample", "Lalonde Sample", "Lalonde Sample", "Lalon…
$ treat     &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ age       &lt;dbl&gt; 37, 37, 22, 22, 30, 30, 27, 27, 33, 33, 22, 22, 23, 23, 32, …
$ education &lt;dbl&gt; 11, 11, 9, 9, 12, 12, 11, 11, 8, 8, 9, 9, 12, 12, 11, 11, 16…
$ black     &lt;dbl&gt; 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, …
$ hispanic  &lt;dbl&gt; 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ married   &lt;dbl&gt; 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, …
$ nodegree  &lt;dbl&gt; 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, …
$ re        &lt;dbl&gt; 0.0000, 9930.0459, 0.0000, 3595.8940, 0.0000, 24909.4492, 0.…
$ post      &lt;int&gt; 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nsw_long, <span class="fu">aes</span>(<span class="at">x =</span> post, <span class="at">y =</span> re, <span class="at">group =</span> <span class="fu">factor</span>(treat))) <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1975"</span>, <span class="st">"1978"</span>)) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"year"</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"income ($)"</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Difference in differences for NSW"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="causality-04-time_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>didreg <span class="ot">&lt;-</span> <span class="fu">lmer</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  re <span class="sc">~</span> treat <span class="sc">*</span> post <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> id), </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> nsw_long, </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">REML =</span> <span class="cn">FALSE</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>didreg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by maximum likelihood  ['lmerMod']
Formula: re ~ treat * post + (1 | id)
   Data: nsw_long
      AIC       BIC    logLik  deviance  df.resid 
 29058.10  29089.75 -14523.05  29046.10      1438 
Random effects:
 Groups   Name        Std.Dev.
 id       (Intercept) 2212    
 Residual             5230    
Number of obs: 1444, groups:  id, 722
Fixed Effects:
(Intercept)        treat         post   treat:post  
    3026.68        39.42      2063.37       846.89  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>ols <span class="ot">&lt;-</span> <span class="fu">lm</span>(re <span class="sc">~</span> treat<span class="sc">*</span>post, <span class="at">data =</span> nsw_long)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">feols</span>(re <span class="sc">~</span> treat<span class="sc">*</span>post <span class="sc">|</span> id, <span class="at">data =</span> nsw_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>The variable 'treat' has been removed because of collinearity (see $collin.var).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>modelsummary<span class="sc">::</span><span class="fu">modelsummary</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">lmer =</span> didreg, <span class="at">lm =</span> ols, <span class="at">feols =</span> m2),</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_map =</span> <span class="fu">c</span>(<span class="st">"nobs"</span>, <span class="st">"icc"</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> lmer </th>
   <th style="text-align:center;"> lm </th>
   <th style="text-align:center;"> feols </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:center;"> 3026.683 </td>
   <td style="text-align:center;"> 3026.683 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (275.435) </td>
   <td style="text-align:center;"> (275.817) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> treat </td>
   <td style="text-align:center;"> 39.415 </td>
   <td style="text-align:center;"> 39.415 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (429.447) </td>
   <td style="text-align:center;"> (430.043) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> post </td>
   <td style="text-align:center;"> 2063.366 </td>
   <td style="text-align:center;"> 2063.366 </td>
   <td style="text-align:center;"> 2063.366 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (358.761) </td>
   <td style="text-align:center;"> (390.065) </td>
   <td style="text-align:center;"> (324.753) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> treat × post </td>
   <td style="text-align:center;"> 846.888 </td>
   <td style="text-align:center;"> 846.888 </td>
   <td style="text-align:center;"> 846.888 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (559.365) </td>
   <td style="text-align:center;"> (608.173) </td>
   <td style="text-align:center;"> (581.796) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> SD (Intercept id) </td>
   <td style="text-align:center;"> 2211.709 </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px"> SD (Observations) </td>
   <td style="text-align:center;box-shadow: 0px 1px"> 5229.795 </td>
   <td style="text-align:center;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Num.Obs. </td>
   <td style="text-align:center;"> 1444 </td>
   <td style="text-align:center;"> 1444 </td>
   <td style="text-align:center;"> 1444 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ICC </td>
   <td style="text-align:center;"> 0.2 </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>Slide 82 add more adjustment variables and see that the estimates remain the same</p>
<p>Note. Using within-person variation is a powerful strategy, but it does not allow for making generalizations about “the overall effect” of something—i.e., it’s the effect <em>conditional</em> on the fact that there <em>is</em> within person variation. We can’t generalize automatically to groups of people that don’t have within person variance.</p>
</section>
<section id="regression-discontinuity" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="regression-discontinuity"><span class="header-section-number">7.4</span> Regression Discontinuity?</h2>
</section>
<section id="additional-resources" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="additional-resources"><span class="header-section-number">7.5</span> Additional Resources</h2>
<dl>
<dt>Difference-in-Differences</dt>
<dd>
<p><span class="citation" data-cites="goodman-bacon2021">Goodman-Bacon (<a href="references.html#ref-goodman-bacon2021" role="doc-biblioref">2021</a>)</span>, <span class="citation" data-cites="callaway2021">Callaway and Sant’Anna (<a href="references.html#ref-callaway2021" role="doc-biblioref">2021</a>)</span>, <span class="citation" data-cites="santanna2020">Sant’Anna and Zhao (<a href="references.html#ref-santanna2020" role="doc-biblioref">2020</a>)</span>, <span class="citation" data-cites="sun2021">Sun and Abraham (<a href="references.html#ref-sun2021" role="doc-biblioref">2021</a>)</span>, <span class="citation" data-cites="dechaisemartin2020">De Chaisemartin and d’Haultfoeuille (<a href="references.html#ref-dechaisemartin2020" role="doc-biblioref">2020</a>)</span></p>
</dd>
<dt>Regression Discontinuity</dt>
<dd>
<p><span class="citation" data-cites="gelman2019">Gelman and Imbens (<a href="references.html#ref-gelman2019" role="doc-biblioref">2019</a>)</span>, <span class="citation" data-cites="gelman2015">Gelman and Zelizer (<a href="references.html#ref-gelman2015" role="doc-biblioref">2015</a>)</span></p>
</dd>
</dl>
</section>
<section id="extra" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="extra"><span class="header-section-number">7.6</span> Extra</h2>
<p>Between and within variation.</p>
<p>Two typical situations:</p>
<ul>
<li><p>clusters (e.g., students nested in classrooms).</p></li>
<li><p>repeated observations (i.e., observations nested in subjects)</p></li>
</ul>
<p>fixed effects is like your mom saying “you should not compare yourself to other people”</p>
<p>fixed effects driven estimates might not generalize to people who don’t change</p>
<p>intra-class correlation <span class="math inline">\(\to\)</span> variance partitioning coefficient</p>
<p>when there is no within-person variation (what year were you born?), vpc = 100%</p>
<p>averages predicting averages is not the same as fluctuations predicting fluctuations</p>
<p>Extending the mixed model (slide 131)</p>
<p>Within-between hybrid model</p>
<p><span class="math display">\[
y_{it} = \gamma_0 + \gamma_1 z_i + \beta_W (x_{it} - \bar x_i) + \beta_B \bar x_i + \theta_t + \alpha_i + \epsilon_{it}
\]</span></p>
<p>by construction, <span class="math inline">\(\alpha_i\)</span> and <span class="math inline">\((x_{it} - \bar x_i)\)</span> are independent</p>
<p>Correlated random effects (contextual) model</p>
<p><span class="math display">\[
y_{it} = \gamma_0 + \gamma_1 z_i + \beta_W x_{it} + \beta_C \bar x_i + \theta_t + \alpha_i + \epsilon_{it}
\]</span></p>
<p>Note <span class="math inline">\(\beta_C = \beta_B - \beta_W\)</span></p>
<p>Both fit the data equally well, but the interpretation of the coefficients is slightly different.</p>
<p><span class="math inline">\(\beta_W\)</span> is literally the same thing you get when using “fixed effects”</p>
<p>Schunck and Perales Within and between cluster effects in generalized linear mixed models</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-callaway2021" class="csl-entry" role="doc-biblioentry">
Callaway, Brantly, and Pedro HC Sant’Anna. 2021. <span>“Difference-in-Differences with Multiple Time Periods.”</span> <em>Journal of Econometrics</em> 225 (2): 200230.
</div>
<div id="ref-dechaisemartin2020" class="csl-entry" role="doc-biblioentry">
De Chaisemartin, Clément, and Xavier d’Haultfoeuille. 2020. <span>“Two-Way Fixed Effects Estimators with Heterogeneous Treatment Effects.”</span> <em>American Economic Review</em> 110 (9): 29642996.
</div>
<div id="ref-gelman2020" class="csl-entry" role="doc-biblioentry">
Gelman, Andrew, Jennifer Hill, and Aki Vehtari. 2020. <em>Regression and Other Stories</em>. Cambridge University Press.
</div>
<div id="ref-gelman2019" class="csl-entry" role="doc-biblioentry">
Gelman, Andrew, and Guido Imbens. 2019. <span>“Why High-Order Polynomials Should Not Be Used in Regression Discontinuity Designs.”</span> <em>Journal of Business &amp; Economic Statistics</em> 37 (3): 447456.
</div>
<div id="ref-gelman2015" class="csl-entry" role="doc-biblioentry">
Gelman, Andrew, and Adam Zelizer. 2015. <span>“Evidence on the Deleterious Impact of Sustained Use of Polynomial Regression on Causal Inference.”</span> <em>Research &amp; Politics</em> 2 (1): 2053168015569830.
</div>
<div id="ref-goodman-bacon2021" class="csl-entry" role="doc-biblioentry">
Goodman-Bacon, Andrew. 2021. <span>“Difference-in-Differences with Variation in Treatment Timing.”</span> <em>Journal of Econometrics</em> 225 (2): 254277.
</div>
<div id="ref-santanna2020" class="csl-entry" role="doc-biblioentry">
Sant’Anna, Pedro HC, and Jun Zhao. 2020. <span>“Doubly Robust Difference-in-Differences Estimators.”</span> <em>Journal of Econometrics</em> 219 (1): 101122.
</div>
<div id="ref-sun2021" class="csl-entry" role="doc-biblioentry">
Sun, Liyang, and Sarah Abraham. 2021. <span>“Estimating Dynamic Treatment Effects in Event Studies with Heterogeneous Treatment Effects.”</span> <em>Journal of Econometrics</em>, Themed Issue: Treatment Effect 1, 225 (2): 175–99. <a href="https://doi.org/10.1016/j.jeconom.2020.09.006">https://doi.org/10.1016/j.jeconom.2020.09.006</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./causality-03-matching.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Matching</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./other-00-intro.html" class="pagination-link">
        <span class="nav-page-text">Other</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>