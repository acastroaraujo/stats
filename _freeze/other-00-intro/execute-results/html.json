{
  "hash": "0b4928d8b4610fad8474546b5d69d1bb",
  "result": {
    "markdown": "# Spatial Statistics\n\nTemporary placeholder for spatial stuff.\n\nSuppose we are predicting an outcome $y$ (e.g., crime rates) for which we think there is an important amount of spatial organization. We can then think of a distance matrix $\\mathbf W$ that connects every observation in the $\\mathbf y$ vector. This matrix is going to have certain properties (e.g., symmetric, non-negative, diagonals equal to zero).\n\nA \"spatial lag model\" takes advantage of these distances:\n\n$$\n\\mathbf{y} = \\rho \\mathbf{Wy} + \\mathbf{X} \\boldsymbol \\beta + \\boldsymbol \\varepsilon\n$$\n\nSee: catchment areas\n\n## Misc\n\n> *Everything is related to everything else, but near things are more related than distant things.*\n\nspatial autocorrelation\n\nmaybe change to embedding section\n\nMartin: gravity model, decay parameters with distance, this looks like GP imho\n\n$$\nI_{ij} = \\alpha \\cdot \\frac{M_i \\cdot M_j}{d_{ij}^{\\beta}}\n$$\n\nIn such a model, $M$ represents the \"mass\" at locations $i$ and $j$; $d$ is some distance metric between $i$ and $j$; $\\alpha$ and $\\beta$ are parameters to be estimated; and $I_{ij}$ represents the \"flow\" or \"exchange\" between $i$ and $j$.\n\nwhat the fuck are kernels?\n\nkernel density estimation?\n\nhttps://mgimond.github.io/Spatial/chp11_0.html#chp11_0\n\nhttps://mgimond.github.io/Spatial/spatial-autocorrelation.html\n\nvariograms\n\nhttps://doi-org.proxy.lib.duke.edu/10.1016/j.spasta.2017.02.006\n\nhttps://r-spatial.org/book/11-PointPattern.html\n\n## Spatial Point Pattern Analysis\n\nPoint pattern analysis is concerned with describing patterns of points over space and making inference about the process that could have generated an observed pattern.\n\n> Important concepts of point patterns analysis are the distinction between a point *pattern* and a point *process*: the latter is the stochastic process that, when sampled, generates a point pattern. A dataset is always a point pattern, and inference involves figuring out the properties of a process that could have generated a pattern like the one we observed. Properties of a spatial point process include\n>\n> -   first order properties: the intensity function measures the number of points per area unit; this function is spatially varying for a *inhomogeneous* point process\n>\n> -   second order properties: given a constant or varying intensity function, describe whether points are distributed independently *from one another*, tend to attract each other (clustering), or repulse each other (more regularly distributed than under complete spatial randomness)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sf)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLinking to GEOS 3.10.2, GDAL 3.4.2, PROJ 8.2.1; sf_use_s2() is TRUE\n```\n:::\n\n```{.r .cell-code}\nD <- 2\nN <- 300\nmu <- rep(0, D)\n\n\nsim <- mvtnorm::rmvnorm(N, mu, diag(D))\n\ndf <- as.data.frame(sim) |> \n  setNames(letters[1:D]) |> \n  st_as_sf(coords = letters[1:D])\n\nplot(df, pch = 21, cex = 1/2)\n```\n\n::: {.cell-output-display}\n![](other-00-intro_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n\n```{.r .cell-code}\nlibrary(spatstat)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: spatstat.data\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: spatstat.geom\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nspatstat.geom 3.2-1\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: spatstat.random\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nspatstat.random 3.1-5\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: spatstat.explore\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: nlme\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nspatstat.explore 3.2-1\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: spatstat.model\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: rpart\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nspatstat.model 3.2-4\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: spatstat.linnet\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nspatstat.linnet 3.1-1\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nspatstat 3.0-6 \nFor an introduction to spatstat, type 'beginner' \n```\n:::\n\n```{.r .cell-code}\npp <- as.ppp(df)\nqcount <- quadratcount(pp, nx = 10, ny = 10)\nplot(pp, cex = 1/5)\nplot(qcount, add = TRUE)\n```\n\n::: {.cell-output-display}\n![](other-00-intro_files/figure-html/unnamed-chunk-1-2.png){width=672}\n:::\n\n```{.r .cell-code}\ndens <- density(pp, sigma = bw.diggle)\nplot(dens)\nplot(pp, cex = 1/5, add = TRUE, col = \"white\")\n```\n\n::: {.cell-output-display}\n![](other-00-intro_files/figure-html/unnamed-chunk-1-3.png){width=672}\n:::\n\n```{.r .cell-code}\ns <- stars::st_as_stars(dens)\n\npt <- st_sfc(st_point(c(0, 0))) ## center\ns$dist <- st_as_sf(s, as_points = TRUE, na.rm = FALSE) |> st_distance(pt)\n\nmod <- ppm(pp ~ dist, data = list(dist = as.im(s[\"dist\"])))\nmod\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nNonstationary Poisson process\nFitted to point pattern dataset 'pp'\n\nLog intensity:  ~dist\n\nFitted trend coefficients:\n(Intercept)        dist \n   4.600546   -1.389613 \n\n             Estimate      S.E.   CI95.lo   CI95.hi Ztest      Zval\n(Intercept)  4.600546 0.1113939  4.382218  4.818874   ***  41.29981\ndist        -1.389613 0.0759040 -1.538382 -1.240844   *** -18.30751\n```\n:::\n\n```{.r .cell-code}\nplot(mod, se = FALSE)\n```\n\n::: {.cell-output-display}\n![](other-00-intro_files/figure-html/unnamed-chunk-1-4.png){width=672}\n:::\n:::\n",
    "supporting": [
      "other-00-intro_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}